<!DOCTYPE html>
<html lang="tr">
<%- include('../partials/shop-head', { title: 'Ã–deme' }) %>

  <body>
    <%- include('../partials/shop-header') %>
      <main class="page page-checkout">
        <section class="page-intro">
          <div class="container intro-heading">
            <span class="eyebrow">SipariÅŸ 3/3</span>
            <h1>Ã–demenizi tamamlayÄ±n.</h1>
            <p>Teslimat detaylarÄ±nÄ± paylaÅŸÄ±n; <%= settings.site_name %> ekibi harmanÄ±nÄ±zÄ± hazÄ±rlayÄ±p adresinize
                ulaÅŸtÄ±rsÄ±n.</p>
            <div class="checkout-steps">
              <span class="step">Sepet</span>
              <span class="divider"></span>
              <span class="step">Bilgiler</span>
              <span class="divider"></span>
              <span class="step is-active">Onay</span>
            </div>
          </div>
        </section>

        <section class="container">
          <%- include('../partials/flash') %>
            <% if (!cart.items.length) { %>
              <div class="empty-state elevated">
                <h3>Sepetiniz boÅŸ</h3>
                <p>Ã–deme adÄ±mÄ±na geÃ§mek iÃ§in Ã¶nce Ã¼rÃ¼n eklemelisiniz.</p>
                <a class="btn btn-primary" href="/">MaÄŸazaya DÃ¶n</a>
              </div>
              <% } else { %>
                <% const shippingAddresses=addresses && addresses.shipping ? addresses.shipping : []; %>
                  <% const billingAddresses=addresses && addresses.billing ? addresses.billing : []; %>
                    <div class="checkout-shell">
                      <article class="checkout-panel checkout-form-card">
                        <header>
                          <span class="eyebrow">Teslimat Bilgileri</span>
                          <h2>Sadece birkaÃ§ bilgi daha.</h2>
                          <p>GÃ¶nderi adresinizi ekleyin; seÃ§tiÄŸiniz harman <strong>24 saat</strong> iÃ§inde yola Ã§Ä±ksÄ±n.
                          </p>
                        </header>
                        <form action="/checkout" method="POST" class="checkout-form">
                          <input type="hidden" name="_csrf" value="<%= csrfToken %>">
                          <div class="form-grid">
                            <label>
                              E-posta
                              <input name="email" type="email" autocomplete="email"
                                value="<%= currentUser ? currentUser.email : '' %>" required>
                            </label>
                            <label>
                              Telefon
                              <input name="shipping_phone" type="tel" autocomplete="tel"
                                value="<%= currentUser && currentUser.phone ? currentUser.phone : '+90 ' %>">
                            </label>
                          </div>

                          <% if (shippingAddresses.length) { %>
                            <label class="address-select">
                              KayÄ±tlÄ± teslimat adresi
                              <select name="shippingAddressId">
                                <option value="">Yeni adres kullanacaÄŸÄ±m</option>
                                <% shippingAddresses.forEach(addr=> { %>
                                  <option value="<%= addr.id %>">
                                    <%= addr.title ? addr.title + ' â€” ' : '' %>
                                      <%= addr.recipientName %>, <%= addr.city %>
                                  </option>
                                  <% }) %>
                              </select>
                            </label>
                            <p class="form-hint">KayÄ±tlÄ± adres seÃ§erseniz aÅŸaÄŸÄ±daki alanlarÄ± doldurmanÄ±za gerek yoktur.
                            </p>
                            <% } %>

                              <div class="form-grid">
                                <label>
                                  AlÄ±cÄ± AdÄ±
                                  <input name="shipping_name" value="<%= currentUser ? currentUser.name : '' %>"
                                    placeholder="Ad Soyad">
                                </label>
                                <label>
                                  Åžehir
                                  <input name="shipping_city" autocomplete="address-level2" placeholder="Ä°stanbul">
                                </label>
                                <label>
                                  Ä°lÃ§e
                                  <input name="shipping_district" placeholder="KadÄ±kÃ¶y">
                                </label>
                                <label>
                                  Posta Kodu
                                  <input name="shipping_postal" placeholder="34000">
                                </label>
                              </div>
                              <label>
                                Adres
                                <textarea name="shipping_address" rows="3" autocomplete="street-address"
                                  placeholder="Mahalle, sokak, bina, daire"></textarea>
                              </label>
                              <label>
                                Ãœlke
                                <input name="shipping_country" value="TÃ¼rkiye">
                              </label>

                              <% if (currentUser) { %>
                                <label class="checkbox-inline">
                                  <input type="checkbox" name="save_shipping" value="on"> Bu adresi kaydet / varsayÄ±lan
                                  yap
                                </label>
                                <% } %>

                                  <hr class="form-divider">
                                  <h3>Fatura Bilgileri</h3>
                                  <label class="checkbox-inline">
                                    <input type="checkbox" name="billingSame" value="on" checked> Fatura adresim
                                    teslimat adresi ile aynÄ±
                                  </label>

                                  <% if (billingAddresses.length) { %>
                                    <label class="address-select">
                                      KayÄ±tlÄ± fatura adresi
                                      <select name="billingAddressId">
                                        <option value="">Yeni adres kullanacaÄŸÄ±m</option>
                                        <% billingAddresses.forEach(addr=> { %>
                                          <option value="<%= addr.id %>">
                                            <%= addr.title ? addr.title + ' â€” ' : '' %>
                                              <%= addr.recipientName %>, <%= addr.city %>
                                          </option>
                                          <% }) %>
                                      </select>
                                    </label>
                                    <p class="form-hint">FarklÄ± bir fatura adresi isterseniz alanlarÄ± doldurun.</p>
                                    <% } %>

                                      <div class="form-grid">
                                        <label>
                                          Fatura AdÄ±
                                          <input name="billing_name" placeholder="Ad Soyad / Firma">
                                        </label>
                                        <label>
                                          Åžehir
                                          <input name="billing_city" placeholder="Ä°stanbul">
                                        </label>
                                        <label>
                                          Ä°lÃ§e
                                          <input name="billing_district" placeholder="BeÅŸiktaÅŸ">
                                        </label>
                                        <label>
                                          Posta Kodu
                                          <input name="billing_postal" placeholder="34000">
                                        </label>
                                      </div>
                                      <label>
                                        Fatura Adresi
                                        <textarea name="billing_address" rows="3"
                                          placeholder="Fatura adresiniz"></textarea>
                                      </label>
                                      <label>
                                        Ãœlke
                                        <input name="billing_country" value="TÃ¼rkiye">
                                      </label>
                                      <label>
                                        Fatura Telefonu
                                        <input name="billing_phone" placeholder="+90 ...">
                                      </label>
                                      <% if (currentUser) { %>
                                        <label class="checkbox-inline">
                                          <input type="checkbox" name="save_billing" value="on"> Fatura adresini kaydet
                                        </label>
                                        <% } %>

                                          <label>
                                            SipariÅŸ Notu
                                            <textarea name="notes" rows="3"
                                              placeholder="Teslimat saat aralÄ±ÄŸÄ±, kapÄ± ÅŸifresi vb."></textarea>
                                          </label>

                                          <div class="secure-badge">
                                            <span>ðŸ”’</span>
                                            <p>TÃ¼m Ã¶demeler 256-bit SSL ile ÅŸifrelenir. Bilgileriniz yalnÄ±zca sipariÅŸi
                                              tamamlamak iÃ§in kullanÄ±lÄ±r.</p>
                                          </div>
                                          <button type="submit" class="btn btn-primary btn-lg full-width">SipariÅŸi
                                            Tamamla</button>
                        </form>
                      </article>

                      <aside class="checkout-panel order-panel">
                        <header>
                          <span class="eyebrow">SipariÅŸ Ã–zeti</span>
                          <h2>Tek yudumda mutluluk.</h2>
                        </header>
                        <div class="order-items">
                          <% cart.items.forEach(item=> { %>
                            <div class="order-item">
                              <div class="item-meta">
                                <span class="item-name">
                                  <%= item.name %>
                                </span>
                                <small>x<%= item.quantity %></small>
                              </div>
                              <span class="item-price">
                                <%= (item.price * item.quantity).toFixed(2) %> â‚º
                              </span>
                            </div>
                            <% }) %>
                        </div>
                        <% const checkoutThreshold=cart.freeShippingThreshold.toLocaleString('tr-TR'); %>
                          <dl class="order-totals">
                            <div>
                              <dt>Ara Toplam</dt>
                              <dd>
                                <%= cart.subtotal.toFixed(2) %> â‚º
                              </dd>
                            </div>
                            <% if (cart.discount && (cart.discountApplied || cart.discountAmount> 0 ||
                              cart.discountReason)) { %>
                              <div>
                                <dt>Ä°ndirim</dt>
                                <dd>
                                  <% if (cart.discountApplied) { %>
                                    -â‚º<%= cart.discountAmount.toFixed(2) %>
                                      <% } else { %>
                                        -â‚º0.00
                                        <% } %>
                                </dd>
                              </div>
                              <% } %>
                                <div>
                                  <dt>Kargo</dt>
                                  <dd>
                                    <% if (cart.shippingAmount===0) { %>
                                      Ãœcretsiz (â‚º<%= checkoutThreshold %> Ã¼zeri)
                                        <% } else { %>
                                          <%= cart.shippingAmount.toFixed(2) %> â‚º
                                            <% } %>
                                  </dd>
                                </div>
                                <div class="highlight">
                                  <dt>Ã–denecek Tutar</dt>
                                  <dd>
                                    <%= cart.totalAmount.toFixed(2) %> â‚º
                                  </dd>
                                </div>
                          </dl>
                          <% if (cart.discount) { %>
                            <p class="order-discount">
                              Kod: <strong>
                                <%= cart.discount.code %>
                              </strong>
                              <% if (cart.discountApplied) { %>
                                (â‚º<%= cart.discountAmount.toFixed(2) %> indirim)
                                  <% } else if (cart.discountReason==='minimum' && cart.discountMinimumRemaining> 0) {
                                    %>
                                    â€” â‚º<%= cart.discountMinimumRemaining.toFixed(2) %> daha ekleyin.
                                      <% } else if (cart.discountReason && cart.discountReason !=='minimum' ) { %>
                                        â€” <span>kod ÅŸu anda uygulanamÄ±yor.</span>
                                        <% } %>
                            </p>
                            <% } %>
                              <div class="order-note">
                                <span>ðŸ’¡</span>
                                <p>
                                  <%= settings.site_name %> Club Ã¼yeliÄŸi ile her sipariÅŸte %10 indirim ve Ã¶ncelikli
                                    kargo fÄ±rsatÄ± yakalayÄ±n.
                                </p>
                              </div>
                      </aside>
                    </div>
                    <% } %>
        </section>
      </main>
      <%- include('../partials/shop-footer') %>
  </body>

</html>