<!DOCTYPE html>
<html lang="tr">
<%- include('../partials/shop-head', { title: 'Ã–deme' }) %>
<body>
  <%- include('../partials/shop-header') %>
  <main class="page page-checkout">
    <section class="page-intro">
      <div class="container intro-heading">
        <span class="eyebrow">SipariÅŸ 3/3</span>
        <h1>Ã–demenizi tamamlayÄ±n.</h1>
        <p>Teslimat detaylarÄ±nÄ± paylaÅŸÄ±n; Tea2Tea ekibi harmanÄ±nÄ±zÄ± hazÄ±rlayÄ±p adresinize ulaÅŸtÄ±rsÄ±n.</p>
        <div class="checkout-steps">
          <span class="step">Sepet</span>
          <span class="divider"></span>
          <span class="step">Bilgiler</span>
          <span class="divider"></span>
          <span class="step is-active">Onay</span>
        </div>
      </div>
    </section>

    <section class="container">
      <%- include('../partials/flash') %>
      <% if (!cart.items.length) { %>
        <div class="empty-state elevated">
          <h3>Sepetiniz boÅŸ</h3>
          <p>Ã–deme adÄ±mÄ±na geÃ§mek iÃ§in Ã¶nce Ã¼rÃ¼n eklemelisiniz.</p>
          <a class="btn btn-primary" href="/">MaÄŸazaya DÃ¶n</a>
        </div>
      <% } else { %>
        <div class="checkout-shell">
          <article class="checkout-panel checkout-form-card">
            <header>
              <span class="eyebrow">Teslimat Bilgileri</span>
              <h2>Sadece birkaÃ§ bilgi daha.</h2>
              <p>GÃ¶nderi adresinizi ekleyin; seÃ§tiÄŸiniz harman <strong>24 saat</strong> iÃ§inde yola Ã§Ä±ksÄ±n.</p>
            </header>
            <form action="/checkout" method="POST" class="checkout-form">
          <div class="form-grid">
            <label>
              Ad Soyad
              <input name="name" autocomplete="name" value="<%= currentUser ? currentUser.name : '' %>" required>
            </label>
            <label>
              E-posta
              <input name="email" type="email" autocomplete="email" value="<%= currentUser ? currentUser.email : '' %>" required>
            </label>
            <label>
              Telefon
              <input
                name="phone"
                type="tel"
                autocomplete="tel"
                value="<%= currentUser && currentUser.phone ? currentUser.phone : '+90 ' %>">
            </label>
                <label>
                  Åehir
                  <input name="city" autocomplete="address-level2" required>
                </label>
              </div>
              <label>
                Adres
                <textarea name="address" rows="3" autocomplete="street-address" required></textarea>
              </label>
              <label>
                Teslimat Notu
                <textarea name="notes" rows="3" placeholder="Teslimat saat aralÄ±ÄŸÄ±, kapÄ± ÅŸifresi vb."></textarea>
              </label>
              <div class="secure-badge">
                <span>ğŸ”’</span>
                <p>TÃ¼m Ã¶demeler 256-bit SSL ile ÅŸifrelenir. Bilgileriniz yalnÄ±zca sipariÅŸi tamamlamak iÃ§in kullanÄ±lÄ±r.</p>
              </div>
              <button type="submit" class="btn btn-primary btn-lg full-width">SipariÅŸi Tamamla</button>
            </form>
          </article>

          <aside class="checkout-panel order-panel">
            <header>
              <span class="eyebrow">SipariÅŸ Ã–zeti</span>
              <h2>Tek yudumda mutluluk.</h2>
            </header>
            <div class="order-items">
              <% cart.items.forEach(item => { %>
                <div class="order-item">
                  <div class="item-meta">
                    <span class="item-name"><%= item.name %></span>
                    <small>x<%= item.quantity %></small>
                  </div>
                  <span class="item-price"><%= (item.price * item.quantity).toFixed(2) %> â‚º</span>
                </div>
              <% }) %>
            </div>
            <% const checkoutThreshold = cart.freeShippingThreshold.toLocaleString('tr-TR'); %>
            <dl class="order-totals">
              <div>
                <dt>Ara Toplam</dt>
                <dd><%= cart.subtotal.toFixed(2) %> â‚º</dd>
              </div>
              <div>
                <dt>Kargo</dt>
                <dd>
                  <% if (cart.shippingAmount === 0) { %>
                    Ãœcretsiz (â‚º<%= checkoutThreshold %> Ã¼zeri)
                  <% } else { %>
                    <%= cart.shippingAmount.toFixed(2) %> â‚º
                  <% } %>
                </dd>
              </div>
              <div class="highlight">
                <dt>Ã–denecek Tutar</dt>
                <dd><%= cart.totalAmount.toFixed(2) %> â‚º</dd>
              </div>
            </dl>
            <div class="order-note">
              <span>ğŸ’¡</span>
              <p>Tea2Tea Club Ã¼yeliÄŸi ile her sipariÅŸte %10 indirim ve Ã¶ncelikli kargo fÄ±rsatÄ± yakalayÄ±n.</p>
            </div>
          </aside>
        </div>
      <% } %>
    </section>
  </main>
  <%- include('../partials/shop-footer') %>
</body>
</html>
